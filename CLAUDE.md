# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

# Claude 設定

## 必須ルール

- 思考（内部推論）は英語で行い、ユーザーへの出力は日本語で行うこと。
- 明示的な承認なしにファイルを変更しないこと。改善の提案は可。
- 明確に要求されない限り、既存コードのリファクタリングは行わないこと。
- 大規模な改善よりも、最小限で局所的な変更を優先すること。

## 変更提案の要件

コード変更を行う前に:

- 何を変更するか説明する
- なぜ必要か説明する
- 想定されるリスクや副作用を説明する

明示的な承認を得てから作業を進めること。

## セキュリティルール

- シークレット、APIキー、認証情報を要求・出力しないこと。
- 個人データをログや出力に含めないこと。
- 開発環境でも本番環境と同等の制約を前提とすること。

## コスト意識

- 回答は簡潔にすること。
- 必要でない限り、大きなコードブロックの繰り返しを避けること。
- 可能な場合、完全な実装よりも説明を優先すること。

# プロジェクトコンテキスト

## プロジェクト概要

Sky Airrace Records — Sky 星を紡ぐ子どもたちのエアレースのタイム記録を管理・表示する静的サイト。ビルドシステム・フレームワーク・パッケージマネージャーは一切不使用。純粋なHTML/CSS/JavaScriptのみで構成。

## 開発方法

ビルドやテストのコマンドはなし。任意の静的ファイルサーバーで配信する:

```
npx serve .
# または
python -m http.server
```

## アーキテクチャ

マルチページアプリケーション。CSS/JSは役割ごとにファイル分離:

- **`index.html`** — ランキング・記録一覧ページ
- **`player.html`** — プレイヤープロフィールページ（スタンプラリーグリッド表示）
- **`data.json`** — 全アプリケーションデータ（records, courseMaster, versionMaster）
- **`css/common.css`** — 共通スタイル + ナビゲーションCSS
- **`css/index.css`** — ランキングページ固有スタイル
- **`css/player.css`** — プレイヤーページ固有スタイル
- **`js/common.js`** — 共通定数（CONTROL_TYPES）・ユーティリティ（formatDate, getUrlParams）・ナビゲーション（DOMContentLoadedでHTML自動挿入）
- **`js/index.js`** — ランキングページ固有ロジック
- **`js/player.js`** — プレイヤーページ固有ロジック

## データフロー

- 両ページとも読み込み時に `data.json` をキャッシュバスティング付き（`?ts=Date.now()`, `cache: "no-store"`）でfetch
- フィルタリング・ソート・表示はすべてクライアントサイドのメモリ上で実行
- 記録はGoogleフォーム経由で外部から投稿され、手動で `data.json` に反映
- データのフィールド名はGoogleフォームの出力に合わせた日本語文字列（例: `ユーザー名`, `タイム`, `コース名`）

## ルーティング

標準的なHTMLリンクとクエリパラメータによるページ遷移:

- `index.html?category=本家&course=No.1` — 大会種別・コースを事前選択
- `player.html?user=@handle` — 特定プレイヤーを表示
- 両ページとも `applyUrlParams()` でパラメータを読み取り、playerページでは検索選択時に `pushState` でURL更新

## 主要パターン

- **2段階フィルタ状態**: アコーディオン内でチップをクリックした「仮選択状態」と、表示ボタンを押して確定した「適用状態」を区別。ランキングの再描画は適用時のみ。
- **カード表示のトランジション**: カードは `visibility: hidden` で描画し、`adjustCardSizes()` 完了後に `is-ready` クラスを付与してレイアウトフラッシュを防止。
- **`CONTROL_TYPES` マッピング**（操作方法 → 絵文字アイコン）は `js/common.js` に一元管理。
- プレイヤー名はX(Twitter)の `@handle` 形式で、`https://x.com/{handle}` にリンク。
