<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sky Air Race è¨˜éŒ²ã¾ã¨ã‚ - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</title>

    <!-- å…±é€šã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ -->

    <script src="navigation.js"></script>

    <style>
      /* ========================================
         åŸºæœ¬è¨­å®š
         ======================================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #cee6f1 0%, #b8e0d4 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 55px; /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨ã®æœ€å°é™ã®ä½™ç™½ */
      }

      /* ========================================
         ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹
         ======================================== */
      .page-header {
        display: none; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éè¡¨ç¤º */
      }

      h1 {
        font-size: 2em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 15px;
      }

      /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ï¼ˆã‚¿ãƒ–é¢¨ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ */
      .player-search-container {
        background: white;
        border-radius: 6px;
        padding: 8px 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        margin-bottom: 12px;
        max-width: 450px;
        margin-left: auto;
        margin-right: auto;
      }

      .search-box-wrapper {
        position: relative;
      }

      .search-label {
        font-size: 0.7em;
        color: #666;
        margin-bottom: 4px;
        display: block;
        font-weight: 500;
      }

      .search-icon {
        position: absolute;
        left: 8px;
        top: calc(50% + 10px); /* ãƒ©ãƒ™ãƒ«åˆ†ã®èª¿æ•´ */
        transform: translateY(-50%);
        font-size: 0.85em;
        color: #999;
      }

      #playerSearchInput {
        width: 100%;
        padding: 6px 8px 6px 28px;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        font-size: 0.85em;
        transition: all 0.3s;
      }

      #playerSearchInput:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
      }

      #playerSearchInput::placeholder {
        color: #bbb;
        font-size: 0.9em;
      }

      /* æœªé¸æŠæ™‚ã®æ¡ˆå†… */
      .search-guide {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .search-guide-icon {
        font-size: 3em;
        margin-bottom: 15px;
      }

      .search-guide h2 {
        font-size: 1.3em;
        color: #333;
        margin-bottom: 10px;
      }

      .search-guide p {
        font-size: 1em;
        line-height: 1.6;
      }

      /* æ¤œç´¢å€™è£œãƒªã‚¹ãƒˆ */
      #playerSuggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid #667eea;
        border-top: none;
        border-radius: 0 0 12px 12px;
        max-height: 300px;
        overflow-y: auto;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        z-index: 100;
        display: none;
      }

      #playerSuggestions.show {
        display: block;
      }

      .suggestion-item {
        padding: 12px 20px;
        cursor: pointer;
        transition: background 0.2s;
        border-bottom: 1px solid #f0f0f0;
      }

      .suggestion-item:last-child {
        border-bottom: none;
      }

      .suggestion-item:hover {
        background: #f5f5f5;
      }

      .suggestion-item.no-results {
        color: #999;
        cursor: default;
        text-align: center;
        font-style: italic;
      }

      .suggestion-item.no-results:hover {
        background: white;
      }

      /* ========================================
         ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¦‚è¦
         ======================================== */
      .player-overview {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 30px;
        text-align: center;
      }

      .player-name {
        font-size: 24px;
        font-weight: 700;
        color: #333;
        margin-bottom: 10px;
      }

      .player-name a {
        color: #667eea;
        text-decoration: none;
      }

      .player-name a:hover {
        text-decoration: underline;
      }

      .player-stats {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .stat-item {
        text-align: center;
      }

      .stat-value {
        font-size: 2em;
        font-weight: 700;
        color: #667eea;
      }

      .stat-label {
        font-size: 0.9em;
        color: #666;
        margin-top: 5px;
      }

      /* ========================================
         ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼å‹ã‚µãƒãƒªãƒ¼
         ======================================== */
      .stamp-rally-section {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 30px;
      }

      .section-title {
        font-size: 1.6em;
        margin-bottom: 20px;
        color: #333;
        font-weight: 700;
        padding-left: 10px;
        border-left: 5px solid #667eea;
      }

      /* ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ */
      .version-selector {
        margin-bottom: 20px;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .version-selector label {
        font-weight: 600;
        color: #555;
      }

      .version-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .version-btn {
        padding: 8px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
        font-size: 0.9em;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
      }

      .version-name {
        font-weight: 600;
      }

      .version-course-count {
        font-size: 0.75em;
        color: #666;
        font-weight: 400;
      }

      .version-btn.selected .version-course-count {
        color: rgba(255, 255, 255, 0.9);
      }

      .version-btn:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .version-btn.selected {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
      }

      /* å¤§ä¼šç¨®åˆ¥ã‚°ãƒ«ãƒ¼ãƒ— */
      .category-group {
        margin-bottom: 40px;
      }

      .category-group:last-child {
        margin-bottom: 0;
      }

      .category-header {
        font-size: 1.3em;
        font-weight: 700;
        color: #555;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
      }

      /* ã‚°ãƒªãƒƒãƒ‰ï¼ˆæ¨ª5ã‚«ãƒ¼ãƒ‰ï¼‰ */
      .course-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        /* gap ã¯ JavaScript ã§å‹•çš„ã«è¨­å®š */
      }

      /* ã‚³ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ */
      .course-card {
        background: linear-gradient(135deg, #f5f5f5 0%, #e9e9e9 100%);
        border-radius: 12px;
        padding: 15px 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 3px solid transparent;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-sizing: border-box;
      }

      .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      }

      /* è¨˜éŒ²ã‚ã‚Š */
      .course-card.has-record {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
      }

      /* è¨˜éŒ²ã‚ã‚Šã‚«ãƒ¼ãƒ‰ã®æ–‡å­—è‰²ã‚’ç™½ã« */
      .course-card.has-record .course-name {
        color: white;
      }

      .course-card.has-record .course-time {
        color: white;
      }

      .course-card.has-record .course-date {
        color: rgba(255, 255, 255, 0.9);
      }

      /* è¨˜éŒ²ãªã— */
      .course-card.no-record {
        background: linear-gradient(135deg, #fafafa 0%, #e0e0e0 100%);
        opacity: 0.7;
      }

      .course-card.no-record:hover {
        opacity: 0.85;
      }

      .course-name {
        font-weight: 700;
        font-size: 0.95em;
        color: #333;
        margin-bottom: 8px;
      }

      .course-time {
        font-size: 1.3em;
        font-weight: 700;
        color: #667eea;
      }

      .course-card.no-record .course-time {
        color: #999;
      }

      .course-date {
        font-size: 0.7em;
        color: #666;
        margin-top: 4px;
        min-height: 1em; /* è¨˜éŒ²ãªã—ã§ã‚‚é«˜ã•ã‚’ç¢ºä¿ */
      }

      /* ========================================
         æå‡ºè¨˜éŒ²ä¸€è¦§
         ======================================== */
      .records-section {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ */
      .records-filter {
        margin-bottom: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
      }

      .filter-header {
        background: linear-gradient(135deg, #f5f5f5 0%, #ececec 100%);
        padding: 6px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        user-select: none;
        transition: background 0.3s;
      }

      .filter-header:hover {
        background: linear-gradient(135deg, #ececec 0%, #e0e0e0 100%);
      }

      .filter-header.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .filter-header-title {
        font-weight: 600;
        font-size: 1em;
      }

      .filter-toggle-icon {
        position: relative;
        width: 22px;
        height: 22px;
        flex-shrink: 0;
      }

      .filter-toggle-icon::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 16px;
        height: 2.5px;
        background: #333;
        transform: translate(-50%, -50%);
      }

      .filter-header.active .filter-toggle-icon::before {
        background: white;
      }

      .filter-toggle-icon::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 2.5px;
        height: 16px;
        background: #333;
        transform: translate(-50%, -50%);
        transition: opacity 0.2s;
      }

      .filter-header.active .filter-toggle-icon::after {
        opacity: 0;
        background: white;
      }

      .filter-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }

      .filter-content.open {
        max-height: 800px;
      }

      .filter-inner {
        padding: 20px;
        background: white;
      }

      .filter-group {
        margin-bottom: 20px;
      }

      .filter-group:last-of-type {
        margin-bottom: 0;
      }

      .filter-group-label {
        font-weight: 600;
        color: #555;
        margin-bottom: 10px;
        display: block;
        font-size: 0.95em;
      }

      /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…ï¼‰ */
      .filter-select {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 0.95em;
        background: white;
        cursor: pointer;
        transition: border-color 0.3s;
      }

      .filter-select:hover {
        border-color: #667eea;
      }

      .filter-select:focus {
        outline: none;
        border-color: #667eea;
      }

      .filter-select:disabled {
        background: #f5f5f5;
        cursor: not-allowed;
      }

      .filter-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .filter-chip {
        padding: 8px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
        user-select: none;
        font-size: 0.9em;
      }

      .filter-chip:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .filter-chip.selected {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
      }

      /* æ‰¿èªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆindexãƒšãƒ¼ã‚¸ã¨çµ±ä¸€ï¼‰ */
      .approval-item {
        display: flex;
        align-items: center;
        padding: 10px;
        border-radius: 8px;
        gap: 10px;
        cursor: pointer;
        user-select: none;
      }

      .approval-item:hover {
        background-color: #f5f5f5;
      }

      /* ä¸¸ã®ã‚¤ãƒ³ã‚±ãƒ¼ã‚¿ãƒ¼ */
      .approval-indicator {
        width: 20px;
        height: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 50%;
        background: white;
        flex-shrink: 0;
        transition: all 0.2s;
        position: relative;
      }

      .approval-item:hover .approval-indicator {
        border-color: #667eea;
      }

      /* é¸æŠæ™‚ï¼šç´«ã§åŸ‹ã¾ã‚‹ */
      .approval-item.selected .approval-indicator {
        border-color: #667eea;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      /* é¸æŠæ™‚ï¼šä¸­å¤®ã«ç™½ã„å°ã•ãªä¸¸ */
      .approval-item.selected .approval-indicator::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: white;
      }

      .approval-label {
        font-weight: 500;
        font-size: 0.95em;
        color: #333;
      }

      /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…ã®ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º */
      .filter-icon {
        font-size: 1.1em;
        margin-right: 5px;
      }

      /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ãƒœã‚¿ãƒ³ã¨ã‚¨ãƒ©ãƒ¼ */
      .filter-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
      }

      .filter-record-count {
        font-size: 0.9em;
        color: #666;
        text-align: center;
      }

      .filter-record-count.error {
        color: #d32f2f;
      }

      .filter-error {
        color: #d32f2f;
        font-size: 0.85em;
        text-align: center;
        display: none;
      }

      .filter-error.show {
        display: block;
      }

      .apply-filter-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .apply-filter-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      }

      .apply-filter-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .records-table-container {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        overflow: hidden;
      }

      thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 0.95em;
        white-space: nowrap;
      }

      tbody tr {
        border-bottom: 1px solid #e0e0e0;
        transition: background 0.2s;
      }

      tbody tr:hover {
        background: #f5f5f5;
      }

      tbody tr:last-child {
        border-bottom: none;
      }

      td {
        padding: 15px;
        font-size: 0.95em;
        white-space: nowrap;
      }

      /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
      .status-badge {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 10px;
        font-size: 0.8em;
        font-weight: 600;
      }

      .status-approved {
        background: #d4edda;
        color: #155724;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      /* å‹•ç”»ãƒªãƒ³ã‚¯ */
      .video-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-size: 12px;
        transition: all 0.3s;
      }

      .video-link:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      /* æ“ä½œã‚»ãƒ« */
      .control-cell {
        font-size: 1.3em;
      }

      /* ========================================
         ç©ºã®çŠ¶æ…‹
         ======================================== */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .empty-state-icon {
        font-size: 4em;
        margin-bottom: 20px;
      }

      .empty-state h2 {
        font-size: 1.8em;
        margin-bottom: 10px;
        color: #555;
      }

      .empty-state p {
        font-size: 1.1em;
        line-height: 1.6;
      }

      /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
      .loading {
        text-align: center;
        padding: 60px 20px;
        font-size: 1.3em;
        color: #667eea;
        font-weight: 600;
      }

      /* ========================================
         ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
         ======================================== */
      @media (max-width: 768px) {
        /* ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
        h1 {
          font-size: 1.5em;
        }

        h2 {
          font-size: 1.2em;
        }

        .section-title {
          font-size: 1.1em;
        }

        .stat-value {
          font-size: 1.8em;
        }

        .stat-label {
          font-size: 0.85em;
        }

        /* ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .version-btn {
          padding: 6px 12px;
          font-size: 0.8em;
        }

        .version-name {
          font-size: 0.9em;
        }

        .version-course-count {
          font-size: 0.7em;
        }

        /* ã‚³ãƒ¼ã‚¹ã‚°ãƒªãƒƒãƒ‰ - ã‚¹ãƒãƒ›ã§ã‚‚5åˆ—ã‚­ãƒ¼ãƒ— */
        .course-grid {
          grid-template-columns: repeat(5, 1fr);
          gap: 8px;
        }

        .course-card {
          padding: 8px 5px;
          height: auto;
          aspect-ratio: 1 / 1;
          border-radius: 8px;
        }

        .course-name {
          font-size: 0.65em;
          margin-bottom: 4px;
          line-height: 1.1;
        }

        .course-time {
          font-size: 0.85em;
        }

        .course-date {
          font-size: 0.5em;
          margin-top: 2px;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è»½æ¸› */
        table {
          font-size: 0.75em;
        }

        th,
        td {
          padding: 8px 4px;
        }

        th {
          font-size: 0.85em;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
        .status-badge {
          padding: 2px 6px;
          font-size: 0.7em;
        }

        /* å‹•ç”»ãƒªãƒ³ã‚¯ */
        .video-link {
          width: 24px;
          height: 24px;
          font-size: 10px;
        }

        /* æ“ä½œã‚»ãƒ« */
        .control-cell {
          font-size: 1.1em;
        }

        /* ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ */
        .category-header {
          font-size: 1em;
          padding: 10px 15px;
        }

        /* ãƒœãƒƒã‚¯ã‚¹ã®paddingã‚’ç¸®å° */
        .player-overview,
        .stamp-rally-section,
        .records-section {
          padding: 15px;
        }

        /* ç©ºã®çŠ¶æ…‹ */
        .empty-state-icon {
          font-size: 3em;
        }

        .empty-state h2 {
          font-size: 1.3em;
        }

        .empty-state p {
          font-size: 0.95em;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ©ãƒ™ãƒ« */
        .filter-group-label {
          font-size: 0.85em;
        }

        .approval-label {
          font-size: 0.85em;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒƒãƒ— */
        .filter-chip {
          padding: 7px 12px;
          font-size: 0.82em;
        }
      }

      /* ========================================
         ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
         ======================================== */

      /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’å³ä¸Šç«¯ã«å›ºå®š */
      .hamburger-icon {
        position: fixed !important;
        top: 0 !important;
        right: 0 !important;
        margin: 0 !important;
        padding: 15px !important;
        z-index: 1001 !important;
        transition: opacity 0.3s ease !important;
      }

      /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã„ã¦ã„ã‚‹æ™‚ã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤º */
      .hamburger-icon.active {
        opacity: 0 !important;
        pointer-events: none !important;
      }

      /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ– */
      .hamburger-icon span {
        transition: none !important;
      }

      .hamburger-icon.active span:nth-child(1),
      .hamburger-icon.active span:nth-child(2),
      .hamburger-icon.active span:nth-child(3) {
        transform: none !important;
        opacity: 1 !important;
      }

      /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¹…ã‚’ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦èª¿æ•´ */
      /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å¤§ç”»é¢ */
      .nav-menu {
        width: 250px !important;
        max-width: 250px !important;
      }

      /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä»¥ä¸‹ */
      @media (max-width: 768px) {
        .nav-menu {
          width: 200px !important;
          max-width: 200px !important;
        }
      }

      /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ */
      @media (max-width: 480px) {
        .nav-menu {
          width: 170px !important;
          max-width: 170px !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯navigation.jsã§è‡ªå‹•æŒ¿å…¥ã•ã‚Œã¾ã™ -->

    <div class="container">
      <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header class="page-header">
        <h1>ğŸ‘¤ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨˜éŒ²</h1>
      </header>

      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢ -->
      <section class="player-search-container">
        <div class="search-box-wrapper">
          <label class="search-label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢</label>
          <span class="search-icon">ğŸ”</span>
          <input
            type="text"
            id="playerSearchInput"
            placeholder="Xã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ï¼ˆä¾‹: @Re_myi_ï¼‰"
            autocomplete="off"
          />
          <div id="playerSuggestions"></div>
        </div>
      </section>

      <!-- æœªé¸æŠæ™‚ã®æ¡ˆå†… -->
      <section id="searchGuide" class="search-guide">
        <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„</h2>
        <p>
          ä¸Šã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰Xã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã™ã‚‹ã¨ã€<br />ãã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¨˜éŒ²ã‚’ç¢ºèªã§ãã¾ã™ã€‚
        </p>
      </section>

      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¦‚è¦ï¼ˆé¸æŠå¾Œã«è¡¨ç¤ºï¼‰ -->
      <section
        id="playerOverview"
        class="player-overview"
        style="display: none"
      >
        <div class="player-name">
          <a id="playerNameLink" href="#" target="_blank"></a>
        </div>
        <div class="player-stats">
          <div class="stat-item">
            <div class="stat-value" id="totalRecordsCount">0</div>
            <div class="stat-label">ç·æå‡ºè¨˜éŒ²æ•°</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="completedCoursesCount">0</div>
            <div class="stat-label">è¨˜éŒ²æ¸ˆã¿ã‚³ãƒ¼ã‚¹æ•°</div>
          </div>
        </div>
      </section>

      <!-- ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼å‹ã‚µãƒãƒªãƒ¼ï¼ˆé¸æŠå¾Œã«è¡¨ç¤ºï¼‰ -->
      <section
        id="stampRallySection"
        class="stamp-rally-section"
        style="display: none"
      >
        <h2 class="section-title">ğŸ¯ ã‚³ãƒ¼ã‚¹åˆ¥ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ </h2>

        <!-- ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="version-selector">
          <label>è¡¨ç¤ºãƒãƒ¼ã‚¸ãƒ§ãƒ³:</label>
          <div class="version-buttons" id="versionButtons"></div>
        </div>

        <!-- ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã‚°ãƒªãƒƒãƒ‰ -->
        <div id="stampRallyGrid"></div>
      </section>

      <!-- æå‡ºè¨˜éŒ²ä¸€è¦§ï¼ˆé¸æŠå¾Œã«è¡¨ç¤ºï¼‰ -->
      <section
        id="recordsSection"
        class="records-section"
        style="display: none"
      >
        <h2 class="section-title">ğŸ“‹ å…¨æå‡ºè¨˜éŒ²</h2>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ -->
        <div class="records-filter">
          <div class="filter-header" id="recordsFilterHeader">
            <span
              class="filter-toggle-icon"
              id="recordsFilterToggleIcon"
            ></span>
            <span class="filter-header-title">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</span>
          </div>
          <div class="filter-content" id="recordsFilterContent">
            <div class="filter-inner">
              <!-- å¤§ä¼šç¨®åˆ¥ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
              <div class="filter-group">
                <label class="filter-group-label">å¤§ä¼šç¨®åˆ¥</label>
                <select id="recordsCategorySelect" class="filter-select">
                  <option value="">-- å¤§ä¼šç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
              </div>

              <!-- ã‚³ãƒ¼ã‚¹ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
              <div class="filter-group">
                <label class="filter-group-label">ã‚³ãƒ¼ã‚¹</label>
                <select id="recordsCourseSelect" class="filter-select" disabled>
                  <option value="">-- ã¾ãšå¤§ä¼šç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
              </div>

              <!-- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
              <div class="filter-group">
                <span class="filter-group-label">ãƒãƒ¼ã‚¸ãƒ§ãƒ³</span>
                <div
                  class="filter-options"
                  id="recordsVersionFilterOptions"
                ></div>
              </div>

              <!-- æ“ä½œæ–¹æ³•ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
              <div class="filter-group">
                <span class="filter-group-label">æ“ä½œæ–¹æ³•</span>
                <div
                  class="filter-options"
                  id="recordsControlFilterOptions"
                ></div>
              </div>

              <!-- æ‰¿èªã®æœ‰ç„¡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
              <div class="filter-group">
                <span class="filter-group-label">æ‰¿èªã®æœ‰ç„¡</span>
                <div
                  class="filter-options"
                  id="recordsApprovalFilterOptions"
                ></div>
              </div>

              <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ãƒœã‚¿ãƒ³ -->
              <div class="filter-actions">
                <div class="filter-record-count" id="recordsFilterRecordCount">
                  è¨˜éŒ²æ•°: 0ä»¶
                </div>
                <div class="filter-error" id="recordsFilterError">
                  å„é …ç›®ã”ã¨ã«1ã¤ä»¥ä¸Šã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
                </div>
                <button class="apply-filter-btn" id="recordsApplyFilterBtn">
                  è¡¨ç¤º
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="records-table-container">
          <table>
            <thead>
              <tr>
                <th>ç”³è«‹æ—¥</th>
                <th>å¤§ä¼šç¨®åˆ¥</th>
                <th>ã‚³ãƒ¼ã‚¹</th>
                <th>ã‚¿ã‚¤ãƒ </th>
                <th>è¨˜éŒ²æ—¥</th>
                <th>æ“ä½œ</th>
                <th>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</th>
                <th>å‹•ç”»</th>
                <th>çŠ¶æ…‹</th>
              </tr>
            </thead>
            <tbody id="recordsTableBody"></tbody>
          </table>
        </div>
      </section>
    </div>

    <script>
      // ========================================
      // çŠ¶æ…‹ç®¡ç†
      // ========================================
      let currentPlayer = null; // ç¾åœ¨é¸æŠä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
      let selectedVersion = "0.24.5~"; // é¸æŠä¸­ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: æœ€æ–°ï¼‰
      let allPlayers = []; // å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒªã‚¹ãƒˆ

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹ï¼ˆå…¨æå‡ºè¨˜éŒ²ç”¨ï¼‰
      let recordsCategory = ""; // é¸æŠã•ã‚ŒãŸå¤§ä¼šç¨®åˆ¥
      let recordsCourse = ""; // é¸æŠã•ã‚ŒãŸã‚³ãƒ¼ã‚¹
      let tempRecordsSelectedVersions = []; // ä¸€æ™‚é¸æŠã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³
      let tempRecordsSelectedControls = []; // ä¸€æ™‚é¸æŠã•ã‚ŒãŸæ“ä½œæ–¹æ³•
      let tempRecordsApprovalFilter = "all"; // ä¸€æ™‚é¸æŠã•ã‚ŒãŸæ‰¿èªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      let isRecordsFilterOpen = false;

      // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢
      let allData = [];
      let courseMaster = [];
      let versionMaster = [];

      // æ“ä½œæ–¹æ³•ã®ã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
      const CONTROL_TYPES = {
        ã‚¿ãƒƒãƒ: "ğŸ‘†",
        "ã‚¿ãƒƒãƒ(ç®’ã‚ã‚Š)": "ğŸ‘†ğŸ§¹",
        ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼: "ğŸ®",
        "ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼(ç®’ã‚ã‚Š)": "ğŸ®ğŸ§¹",
      };

      // ========================================
      // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
      // ========================================

      /**
       * data.jsonã‚’èª­ã¿è¾¼ã‚€
       */
      async function loadData() {
        try {
          const url = `./data.json?ts=${Date.now()}`;
          const response = await fetch(url, { cache: "no-store" });

          if (!response.ok) {
            throw new Error(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—: ${response.status}`);
          }

          const data = await response.json();
          allData = data.records || [];
          courseMaster = data.courseMaster || [];
          versionMaster = data.versionMaster || [];

          console.log(`âœ“ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: ${allData.length}ä»¶ã®è¨˜éŒ²`);
        } catch (error) {
          console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
          throw error;
        }
      }

      /**
       * ISOæ—¥ä»˜æ–‡å­—åˆ—ã‚’ "YYYY/MM/DD" å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
       */
      function formatDate(isoDate) {
        if (!isoDate) return "-";
        const date = new Date(isoDate);
        if (isNaN(date.getTime())) return "-";

        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        return `${year}/${month}/${day}`;
      }

      /**
       * å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—
       */
      function getAllPlayers() {
        const playerSet = new Set();
        allData.forEach((record) => {
          if (record["ãƒ¦ãƒ¼ã‚¶ãƒ¼å"]) {
            playerSet.add(record["ãƒ¦ãƒ¼ã‚¶ãƒ¼å"]);
          }
        });
        return Array.from(playerSet).sort();
      }

      /**
       * ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨è¨˜éŒ²ã‚’å–å¾—
       */
      function getPlayerRecords(username) {
        return allData.filter((record) => record["ãƒ¦ãƒ¼ã‚¶ãƒ¼å"] === username);
      }

      /**
       * ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚’ã‚³ãƒ¼ã‚¹ã”ã¨ã«å–å¾—
       */
      function getPlayerBestTimes(username, targetVersion = "0.24.5~") {
        const playerRecords = allData.filter(
          (record) =>
            record["ãƒ¦ãƒ¼ã‚¶ãƒ¼å"] === username &&
            record["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"] === targetVersion,
        );

        const bestTimes = {};

        playerRecords.forEach((record) => {
          const key = `${record["å¤§ä¼šç¨®åˆ¥"]}_${record["ã‚³ãƒ¼ã‚¹å"]}`;
          const currentTime = parseFloat(record["ã‚¿ã‚¤ãƒ "]);

          if (
            !bestTimes[key] ||
            currentTime < parseFloat(bestTimes[key]["ã‚¿ã‚¤ãƒ "])
          ) {
            bestTimes[key] = record;
          }
        });

        return bestTimes;
      }

      /**
       * å¤§ä¼šç¨®åˆ¥ã”ã¨ã«ã‚³ãƒ¼ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
       */
      function getCoursesByCategory() {
        const grouped = {};

        courseMaster.forEach((course) => {
          const category = course["å¤§ä¼šç¨®åˆ¥"];
          if (!grouped[category]) {
            grouped[category] = [];
          }
          grouped[category].push(course["ã‚³ãƒ¼ã‚¹å"]);
        });

        return grouped;
      }

      /**
       * URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
       */
      function getUrlParams() {
        const params = {};
        const searchParams = new URLSearchParams(window.location.search);
        for (const [key, value] of searchParams) {
          params[key] = value;
        }
        return params;
      }

      /**
       * Xã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ã‚‰ãƒãƒ³ãƒ‰ãƒ«éƒ¨åˆ†ã‚’æŠ½å‡º
       */
      function getXHandle(username) {
        if (!username) return "";
        return username.startsWith("@") ? username.slice(1) : username;
      }

      // ========================================
      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
      // ========================================
      async function init() {
        console.log("âœ“ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒšãƒ¼ã‚¸: åˆæœŸåŒ–é–‹å§‹");

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        await loadData();

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆå–å¾—
        allPlayers = getAllPlayers();
        console.log(`âœ“ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${allPlayers.length}äºº`);

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        setupEventListeners();

        // URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèª
        applyUrlParams();
      }

      /**
       * ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
       */
      function setupEventListeners() {
        const searchInput = document.getElementById("playerSearchInput");
        const suggestionsEl = document.getElementById("playerSuggestions");

        // æ¤œç´¢å…¥åŠ›æ™‚
        searchInput.addEventListener("input", (e) => {
          const query = e.target.value.trim();
          if (query.length > 0) {
            showSuggestions(query);
          } else {
            hideSuggestions();
          }
        });

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ï¼ˆå€™è£œã‚’å†è¡¨ç¤ºï¼‰
        searchInput.addEventListener("focus", (e) => {
          const query = e.target.value.trim();
          if (query.length > 0) {
            showSuggestions(query);
          }
        });

        // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§å€™è£œã‚’é–‰ã˜ã‚‹
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".search-box-wrapper")) {
            hideSuggestions();
          }
        });

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã‚’å†èª¿æ•´
        let resizeTimeout;
        window.addEventListener("resize", () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            adjustCardSizes();
          }, 100);
        });

        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        document.addEventListener("click", (e) => {
          const navMenu = document.querySelector(".nav-menu");
          const hamburger = document.querySelector(".hamburger-icon");
          const overlay = document.querySelector(".nav-overlay");

          // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã®ã¿å‡¦ç†
          if (navMenu && navMenu.classList.contains("active")) {
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†…ã€ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (
              !e.target.closest(".nav-menu") &&
              !e.target.closest(".hamburger-icon")
            ) {
              // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
              navMenu.classList.remove("active");
              if (hamburger) hamburger.classList.remove("active");
              if (overlay) overlay.classList.remove("active");
              document.body.style.overflow = "";
            }
          }
        });
      }

      /**
       * URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’èª­ã¿å–ã£ã¦è¡¨ç¤º
       */
      function applyUrlParams() {
        const params = getUrlParams();
        if (params.user) {
          selectPlayer(params.user);
        }
      }

      /**
       * æ¤œç´¢å€™è£œã‚’è¡¨ç¤º
       * @param {string} query - æ¤œç´¢ã‚¯ã‚¨ãƒª
       */
      function showSuggestions(query) {
        const suggestionsEl = document.getElementById("playerSuggestions");
        const lowerQuery = query.toLowerCase();

        // å€™è£œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const matches = allPlayers.filter((player) =>
          player.toLowerCase().includes(lowerQuery),
        );

        // å€™è£œãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
        if (matches.length > 0) {
          suggestionsEl.innerHTML = matches
            .slice(0, 10) // æœ€å¤§10ä»¶
            .map(
              (player) => `
              <div class="suggestion-item" onclick="selectPlayer('${player}')">
                ${player}
              </div>
            `,
            )
            .join("");
        } else {
          suggestionsEl.innerHTML =
            '<div class="suggestion-item no-results">è©²å½“ã™ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
        }

        suggestionsEl.classList.add("show");
      }

      /**
       * æ¤œç´¢å€™è£œã‚’éè¡¨ç¤º
       */
      function hideSuggestions() {
        const suggestionsEl = document.getElementById("playerSuggestions");
        suggestionsEl.classList.remove("show");
      }

      /**
       * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é¸æŠã—ã¦ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°
       * @param {string} username - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å
       */
      function selectPlayer(username) {
        currentPlayer = username;

        // URLã‚’æ›´æ–°ï¼ˆå±¥æ­´ã«è¿½åŠ ï¼‰
        const newUrl = `${window.location.pathname}?user=${encodeURIComponent(username)}`;
        window.history.pushState({}, "", newUrl);

        // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
        document.getElementById("playerSearchInput").value = username;
        hideSuggestions();

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
        renderPlayerOverview();
        renderStampRally();
        initRecordsFilter(); // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆæœŸåŒ–
        renderRecordsTable();

        // æ¡ˆå†…ã‚’éè¡¨ç¤ºã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
        document.getElementById("searchGuide").style.display = "none";
        document.getElementById("playerOverview").style.display = "block";
        document.getElementById("stampRallySection").style.display = "block";
        document.getElementById("recordsSection").style.display = "block";
      }

      /**
       * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¦‚è¦ã‚’è¡¨ç¤º
       */
      function renderPlayerOverview() {
        const playerNameLink = document.getElementById("playerNameLink");
        const totalRecordsCount = document.getElementById("totalRecordsCount");
        const completedCoursesCount = document.getElementById(
          "completedCoursesCount",
        );

        // Xï¼ˆTwitterï¼‰ãƒªãƒ³ã‚¯
        const xHandle = getXHandle(currentPlayer);
        playerNameLink.textContent = currentPlayer;
        playerNameLink.href = `https://x.com/${xHandle}`;

        // ç·æå‡ºè¨˜éŒ²æ•°
        const playerRecords = getPlayerRecords(currentPlayer);
        totalRecordsCount.textContent = playerRecords.length;

        // è¨˜éŒ²æ¸ˆã¿ã‚³ãƒ¼ã‚¹æ•°ï¼ˆé‡è¤‡ãªã—ï¼‰
        const uniqueCourses = new Set();
        playerRecords.forEach((record) => {
          uniqueCourses.add(`${record["å¤§ä¼šç¨®åˆ¥"]}_${record["ã‚³ãƒ¼ã‚¹å"]}`);
        });
        completedCoursesCount.textContent = uniqueCourses.size;
      }

      /**
       * ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼å‹ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
       */
      function renderStampRally() {
        renderVersionButtons();
        renderStampGrid();
      }

      /**
       * ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
       */
      function renderVersionButtons() {
        const container = document.getElementById("versionButtons");

        // versionMasterã‹ã‚‰å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—
        const versions = versionMaster.map((v) => v["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"]);

        // å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®ã‚³ãƒ¼ã‚¹æ•°ã‚’è¨ˆç®—
        const playerRecords = getPlayerRecords(currentPlayer);

        container.innerHTML = versions
          .map((version) => {
            // ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§è¨˜éŒ²ãŒã‚ã‚‹ã‚³ãƒ¼ã‚¹ã‚’é‡è¤‡ãªã—ã§å–å¾—
            const coursesInVersion = new Set();
            playerRecords.forEach((record) => {
              if (record["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"] === version) {
                coursesInVersion.add(
                  `${record["å¤§ä¼šç¨®åˆ¥"]}_${record["ã‚³ãƒ¼ã‚¹å"]}`,
                );
              }
            });

            const courseCount = coursesInVersion.size;

            return `
            <button 
              class="version-btn ${version === selectedVersion ? "selected" : ""}"
              onclick="changeVersion('${version}')"
            >
              <span class="version-name">${version}</span>
              <span class="version-course-count">${courseCount}ã‚³ãƒ¼ã‚¹</span>
            </button>
          `;
          })
          .join("");
      }

      /**
       * ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´
       * @param {string} version - é¸æŠã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³
       */
      function changeVersion(version) {
        selectedVersion = version;
        renderVersionButtons();
        renderStampGrid();
      }

      /**
       * ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã‚°ãƒªãƒƒãƒ‰ã‚’ç”Ÿæˆ
       */
      function renderStampGrid() {
        const container = document.getElementById("stampRallyGrid");

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚’å–å¾—
        const bestTimes = getPlayerBestTimes(currentPlayer, selectedVersion);

        // å¤§ä¼šç¨®åˆ¥ã”ã¨ã«ã‚³ãƒ¼ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const coursesByCategory = getCoursesByCategory();

        // ã‚°ãƒªãƒƒãƒ‰HTMLç”Ÿæˆ
        let html = "";

        for (const category in coursesByCategory) {
          const courses = coursesByCategory[category];

          html += `
            <div class="category-group">
              <div class="category-header">${category}</div>
              <div class="course-grid">
          `;

          courses.forEach((courseName) => {
            const key = `${category}_${courseName}`;
            const record = bestTimes[key];

            if (record) {
              // è¨˜éŒ²ã‚ã‚Š
              html += `
                <div class="course-card has-record" onclick="navigateToCourse('${category}', '${courseName}')">
                  <div class="course-name">${courseName}</div>
                  <div class="course-time">${record["ã‚¿ã‚¤ãƒ "]}</div>
                  <div class="course-date">${formatDate(record["è¨˜éŒ²æ—¥"])}</div>
                </div>
              `;
            } else {
              // è¨˜éŒ²ãªã—
              html += `
                <div class="course-card no-record" onclick="navigateToCourse('${category}', '${courseName}')">
                  <div class="course-name">${courseName}</div>
                  <div class="course-time">-</div>
                  <div class="course-date"></div>
                </div>
              `;
            }
          });

          html += `
              </div>
            </div>
          `;
        }

        container.innerHTML = html;

        // ã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã‚’èª¿æ•´
        adjustCardSizes();
      }

      /**
       * ã‚«ãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚ºã‚’å‹•çš„ã«èª¿æ•´
       * æ¨ªå¹…: stamprallygridã®æ¨ªå¹…ã‹ã‚‰ã‚«ãƒ¼ãƒ‰5ã¤ã¨å‹•çš„ãªéš™é–“4ã¤ã‚’è€ƒæ…®ã—ã¦è¨ˆç®—
       * ç¸¦å¹…: æ¨ªå¹…ã¨åŒã˜ã ãŒã€100pxãŒä¸Šé™
       * ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º: ã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã«å¿œã˜ã¦å‹•çš„ã«èª¿æ•´
       */
      function adjustCardSizes() {
        // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦ã€DOMãŒå®Œå…¨ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã‹ã‚‰å®Ÿè¡Œ
        setTimeout(() => {
          const grids = document.querySelectorAll(".course-grid");

          grids.forEach((grid) => {
            // ã‚°ãƒªãƒƒãƒ‰ã®æ¨ªå¹…ã‚’å–å¾—
            const gridWidth = grid.offsetWidth;

            // ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ã‚’ã‚°ãƒªãƒƒãƒ‰å¹…ã®2%ã«è¨­å®šï¼ˆå‹•çš„ï¼‰
            const gapSize = gridWidth * 0.02;
            grid.style.gap = `${gapSize}px`;

            // ã‚«ãƒ¼ãƒ‰1ã¤ã®æ¨ªå¹…ã‚’è¨ˆç®—ï¼ˆéš™é–“4ã¤åˆ†ã‚’å¼•ãï¼‰
            const cardWidth = (gridWidth - gapSize * 4) / 5;

            // ã‚«ãƒ¼ãƒ‰ã®ç¸¦å¹…ã¯æ¨ªå¹…ã¨åŒã˜ã ãŒã€100pxãŒä¸Šé™
            const cardHeight = Math.min(cardWidth, 100);

            // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã«å¿œã˜ã¦èª¿æ•´
            // ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚ºã«å¯¾ã™ã‚‹ã‚¹ã‚±ãƒ¼ãƒ«æ¯”ç‡ã‚’è¨ˆç®—ï¼ˆ100pxã‚’åŸºæº–ã¨ã™ã‚‹ï¼‰
            const scale = cardHeight / 100;

            // ã“ã®ã‚°ãƒªãƒƒãƒ‰å†…ã®å…¨ã‚«ãƒ¼ãƒ‰ã«ã‚µã‚¤ã‚ºã¨ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’é©ç”¨
            const cards = grid.querySelectorAll(".course-card");
            cards.forEach((card) => {
              card.style.width = `${cardWidth}px`;
              card.style.height = `${cardHeight}px`;

              // å„è¦ç´ ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´
              const courseName = card.querySelector(".course-name");
              const courseTime = card.querySelector(".course-time");
              const courseDate = card.querySelector(".course-date");

              // ã‚³ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ ã®ã‚µã‚¤ã‚ºã‚’è¨­å®š
              if (courseTime) {
                courseTime.style.fontSize = `${1.3 * scale}em`;
              }

              // ã‚³ãƒ¼ã‚¹åã®ã‚µã‚¤ã‚ºã‚’æ±ºå®š
              if (courseName) {
                const hasJapanese =
                  /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(
                    courseName.textContent,
                  );

                // æ—¥æœ¬èªãªã—ã‚³ãƒ¼ã‚¹åã®åŸºæœ¬ã‚µã‚¤ã‚ºã‚’è¨ˆç®—
                const baseCourseFontSize = 0.95 * scale;

                if (hasJapanese) {
                  // æ—¥æœ¬èªãŒå«ã¾ã‚Œã‚‹å ´åˆ
                  // ã¾ãšæ—¥æœ¬èªãªã—ã‚³ãƒ¼ã‚¹åã®ã‚µã‚¤ã‚ºã‚’è¨­å®šã—ã¦ã€å®Ÿéš›ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚µã‚¤ã‚ºã‚’å–å¾—
                  courseName.style.fontSize = `${baseCourseFontSize}em`;

                  setTimeout(() => {
                    const baseCoursePixelSize = parseFloat(
                      getComputedStyle(courseName).fontSize,
                    );

                    if (baseCoursePixelSize >= 10) {
                      // åŸºæœ¬ã‚µã‚¤ã‚ºãŒ10pxä»¥ä¸Šã®å ´åˆ: -2px
                      const japaneseSize = baseCoursePixelSize - 2;
                      courseName.style.fontSize = `${japaneseSize}px`;

                      // 2è¡Œã«ãªã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                      setTimeout(() => {
                        const lineHeight = parseFloat(
                          getComputedStyle(courseName).lineHeight,
                        );
                        const actualHeight = courseName.offsetHeight;

                        if (actualHeight > lineHeight * 1.5) {
                          // 2è¡Œã®å ´åˆã¯æ—¥æœ¬èªãªã—ã‚³ãƒ¼ã‚¹åã‚µã‚¤ã‚ºã®0.8å€
                          courseName.style.fontSize = `${baseCoursePixelSize * 0.8}px`;
                        }
                      }, 10);
                    } else {
                      // åŸºæœ¬ã‚µã‚¤ã‚ºãŒ10pxæœªæº€ã®å ´åˆ: 8pxå›ºå®š
                      courseName.style.fontSize = "8px";
                    }
                  }, 10);
                } else {
                  // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆãƒ»æ•°å­—ãƒ»è¨˜å·ã®ã¿ã®å ´åˆ
                  courseName.style.fontSize = `${baseCourseFontSize}em`;

                  // 2è¡Œã«ãªã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                  setTimeout(() => {
                    const lineHeight = parseFloat(
                      getComputedStyle(courseName).lineHeight,
                    );
                    const actualHeight = courseName.offsetHeight;

                    if (actualHeight > lineHeight * 1.5) {
                      // 2è¡Œã®å ´åˆã¯ç¾åœ¨ã®ã‚µã‚¤ã‚ºã®0.8å€
                      const currentSize = parseFloat(
                        getComputedStyle(courseName).fontSize,
                      );
                      courseName.style.fontSize = `${currentSize * 0.8}px`;
                    }
                  }, 10);
                }
              }

              if (courseDate) {
                if (courseDate.textContent.trim() !== "" && courseName) {
                  // courseName ã®æœ€çµ‚ãƒ”ã‚¯ã‚»ãƒ«ã‚µã‚¤ã‚ºã‚’å–å¾—
                  const courseNamePixelSize = parseFloat(
                    getComputedStyle(courseName).fontSize,
                  );
                  // courseName ã® 0.6 å€
                  courseDate.style.fontSize = `${courseNamePixelSize * 0.6}px`;
                } else {
                  courseDate.style.fontSize = `${0.7 * scale}em`;
                }
              }
            });
          });
        }, 50);
      }

      /**
       * ã‚³ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ™‚ â†’ ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§ãƒšãƒ¼ã‚¸ã¸é·ç§»
       * @param {string} category - å¤§ä¼šç¨®åˆ¥
       * @param {string} course - ã‚³ãƒ¼ã‚¹å
       */
      function navigateToCourse(category, course) {
        const url = `index.html?category=${encodeURIComponent(category)}&course=${encodeURIComponent(course)}`;
        window.location.href = url;
      }

      /**
       * æå‡ºè¨˜éŒ²ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨æ¸ˆã¿ï¼‰
       */
      function renderRecordsTable() {
        const tbody = document.getElementById("recordsTableBody");

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨è¨˜éŒ²ã‚’å–å¾—ï¼ˆç”³è«‹æ—¥é™é †ï¼‰
        let records = getPlayerRecords(currentPlayer).sort(
          (a, b) =>
            new Date(b["ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—"]) - new Date(a["ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—"]),
        );

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        records = records.filter((record) => {
          // å¤§ä¼šç¨®åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          if (recordsCategory && record["å¤§ä¼šç¨®åˆ¥"] !== recordsCategory) {
            return false;
          }

          // ã‚³ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          if (recordsCourse && record["ã‚³ãƒ¼ã‚¹å"] !== recordsCourse) {
            return false;
          }

          // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          if (
            tempRecordsSelectedVersions.length > 0 &&
            !tempRecordsSelectedVersions.includes(record["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"])
          ) {
            return false;
          }

          // æ“ä½œæ–¹æ³•ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          if (
            tempRecordsSelectedControls.length > 0 &&
            !tempRecordsSelectedControls.includes(record["æ“ä½œæ–¹æ³•"])
          ) {
            return false;
          }

          // æ‰¿èªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          if (
            tempRecordsApprovalFilter === "approved" &&
            record["æ‰¿èªçŠ¶æ…‹"] !== "OK"
          ) {
            return false;
          }

          return true;
        });

        if (records.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="9" style="text-align: center;">è©²å½“ã™ã‚‹è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
          return;
        }

        // ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã‚’ç”Ÿæˆ
        tbody.innerHTML = records
          .map((record) => {
            const statusClass =
              record["æ‰¿èªçŠ¶æ…‹"] === "OK"
                ? "status-approved"
                : "status-pending";
            const statusText =
              record["æ‰¿èªçŠ¶æ…‹"] === "OK" ? "æ‰¿èªæ¸ˆ" : "æœªæ‰¿èª";
            const controlIcon =
              CONTROL_TYPES[record["æ“ä½œæ–¹æ³•"]] || record["æ“ä½œæ–¹æ³•"] || "-";

            return `
            <tr>
              <td>${formatDate(record["ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—"])}</td>
              <td>${record["å¤§ä¼šç¨®åˆ¥"] || "-"}</td>
              <td>${record["ã‚³ãƒ¼ã‚¹å"] || "-"}</td>
              <td><strong>${record["ã‚¿ã‚¤ãƒ "]}ç§’</strong></td>
              <td>${formatDate(record["è¨˜éŒ²æ—¥"])}</td>
              <td class="control-cell">${controlIcon}</td>
              <td>${record["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"] || "-"}</td>
              <td>${record["ãƒªãƒ³ã‚¯"] ? `<a href="${record["ãƒªãƒ³ã‚¯"]}" target="_blank" class="video-link">â–¶</a>` : "-"}</td>
              <td><span class="status-badge ${statusClass}">${statusText}</span></td>
            </tr>
          `;
          })
          .join("");
      }

      // ========================================
      // å…¨æå‡ºè¨˜éŒ²ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
      // ========================================

      /**
       * ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–ï¼ˆãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰ä½œæˆï¼‰
       */
      function initRecordsFilter() {
        // å¤§ä¼šç¨®åˆ¥ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ç”Ÿæˆï¼ˆãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰ï¼‰
        const categories = [
          ...new Set(courseMaster.map((item) => item["å¤§ä¼šç¨®åˆ¥"])),
        ];
        const categorySelect = document.getElementById("recordsCategorySelect");
        categorySelect.innerHTML = '<option value="">ã™ã¹ã¦</option>';
        categories.forEach((cat) => {
          const playerRecords = getPlayerRecords(currentPlayer);
          const count = playerRecords.filter(
            (r) => r["å¤§ä¼šç¨®åˆ¥"] === cat,
          ).length;
          const option = document.createElement("option");
          option.value = cat;
          option.textContent = `${cat} ï¼ˆ${count}ä»¶ï¼‰`;
          categorySelect.appendChild(option);
        });

        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ç”Ÿæˆï¼ˆãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰ï¼‰
        const versionOptions = document.getElementById(
          "recordsVersionFilterOptions",
        );
        versionMaster.forEach((item) => {
          const version = item["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"];
          const chip = document.createElement("div");
          chip.className = "filter-chip selected";
          chip.dataset.version = version;
          chip.textContent = version;
          chip.addEventListener("click", function () {
            this.classList.toggle("selected");
            onRecordsFilterChange();
          });
          versionOptions.appendChild(chip);
        });

        // æ“ä½œæ–¹æ³•ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ç”Ÿæˆï¼ˆãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰ï¼‰
        const controlOptions = document.getElementById(
          "recordsControlFilterOptions",
        );
        Object.entries(CONTROL_TYPES).forEach(([controlType, icon]) => {
          const chip = document.createElement("div");
          chip.className = "filter-chip selected";
          chip.innerHTML = `<span class="filter-icon">${icon}</span>${controlType}`;
          chip.dataset.control = controlType;
          chip.addEventListener("click", function () {
            this.classList.toggle("selected");
            onRecordsFilterChange();
          });
          controlOptions.appendChild(chip);
        });

        // æ‰¿èªã®æœ‰ç„¡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ç”Ÿæˆ
        const approvalOptions = document.getElementById(
          "recordsApprovalFilterOptions",
        );
        const approvalTypes = [
          { value: "all", label: "ã™ã¹ã¦" },
          { value: "approved", label: "æ‰¿èªæ¸ˆã®ã¿" },
        ];
        approvalTypes.forEach((type) => {
          const item = document.createElement("div");
          item.className =
            type.value === "all" ? "approval-item selected" : "approval-item";
          item.dataset.value = type.value;
          item.innerHTML = `
            <div class="approval-indicator"></div>
            <span class="approval-label">${type.label}</span>
          `;
          item.addEventListener("click", () => {
            document
              .querySelectorAll("#recordsApprovalFilterOptions .approval-item")
              .forEach((el) => {
                el.classList.remove("selected");
              });
            item.classList.add("selected");
            onRecordsFilterChange();
          });
          approvalOptions.appendChild(item);
        });

        // å¤§ä¼šç¨®åˆ¥å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
        categorySelect.addEventListener("change", onRecordsCategoryChange);

        // ã‚³ãƒ¼ã‚¹å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
        const courseSelect = document.getElementById("recordsCourseSelect");
        courseSelect.addEventListener("change", updateRecordsFilterRecordCount);

        // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        const header = document.getElementById("recordsFilterHeader");
        header.addEventListener("click", toggleRecordsFilterAccordion);

        // è¡¨ç¤ºãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        const applyBtn = document.getElementById("recordsApplyFilterBtn");
        applyBtn.addEventListener("click", applyRecordsFilter);

        // åˆæœŸåŒ–æ™‚ã¯å…¨é¸æŠçŠ¶æ…‹
        tempRecordsSelectedVersions = versionMaster.map((v) => v["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"]);
        tempRecordsSelectedControls = Object.keys(CONTROL_TYPES);
        tempRecordsApprovalFilter = "all";

        // åˆæœŸè¨˜éŒ²æ•°ã‚’æ›´æ–°
        updateRecordsFilterRecordCount();
      }

      /**
       * å¤§ä¼šç¨®åˆ¥å¤‰æ›´æ™‚ã®å‡¦ç†
       */
      function onRecordsCategoryChange() {
        const category = document.getElementById("recordsCategorySelect").value;
        const courseSelect = document.getElementById("recordsCourseSelect");

        courseSelect.innerHTML =
          '<option value="">-- ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>';

        if (category) {
          courseSelect.disabled = false;

          // é¸æŠã•ã‚ŒãŸå¤§ä¼šç¨®åˆ¥ã®ã‚³ãƒ¼ã‚¹ã‚’å–å¾—ï¼ˆãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰ï¼‰
          const courses = courseMaster.filter(
            (item) => item["å¤§ä¼šç¨®åˆ¥"] === category,
          );
          const playerRecords = getPlayerRecords(currentPlayer);

          courses.forEach((item) => {
            const courseName = item["ã‚³ãƒ¼ã‚¹å"];
            const count = playerRecords.filter(
              (r) => r["å¤§ä¼šç¨®åˆ¥"] === category && r["ã‚³ãƒ¼ã‚¹å"] === courseName,
            ).length;

            const option = document.createElement("option");
            option.value = courseName;
            option.textContent = `${courseName} ï¼ˆ${count}ä»¶ï¼‰`;
            courseSelect.appendChild(option);
          });
        } else {
          courseSelect.disabled = true;
        }

        updateRecordsFilterRecordCount();
      }

      /**
       * ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚ã®å‡¦ç†ï¼ˆè¨˜éŒ²æ•°æ›´æ–°ï¼‰
       */
      function onRecordsFilterChange() {
        // ä¸€æ™‚é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
        tempRecordsSelectedVersions = [];
        document
          .querySelectorAll(
            "#recordsVersionFilterOptions .filter-chip.selected",
          )
          .forEach((chip) => {
            tempRecordsSelectedVersions.push(chip.dataset.version);
          });

        tempRecordsSelectedControls = [];
        document
          .querySelectorAll(
            "#recordsControlFilterOptions .filter-chip.selected",
          )
          .forEach((chip) => {
            tempRecordsSelectedControls.push(chip.dataset.control);
          });

        // æ‰¿èªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        const selectedApproval = document.querySelector(
          "#recordsApprovalFilterOptions .approval-item.selected",
        );
        if (selectedApproval) {
          tempRecordsApprovalFilter = selectedApproval.dataset.value;
        }

        updateRecordsFilterRecordCount();
      }

      /**
       * ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨˜éŒ²æ•°ã‚’æ›´æ–°
       */
      function updateRecordsFilterRecordCount() {
        const category = document.getElementById("recordsCategorySelect").value;
        const course = document.getElementById("recordsCourseSelect").value;
        const playerRecords = getPlayerRecords(currentPlayer);

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã«åˆè‡´ã™ã‚‹è¨˜éŒ²æ•°ã‚’è¨ˆç®—
        const filteredCount = playerRecords.filter((record) => {
          if (category && record["å¤§ä¼šç¨®åˆ¥"] !== category) return false;
          if (course && record["ã‚³ãƒ¼ã‚¹å"] !== course) return false;
          if (
            tempRecordsSelectedVersions.length > 0 &&
            !tempRecordsSelectedVersions.includes(record["ãƒãƒ¼ã‚¸ãƒ§ãƒ³"])
          )
            return false;
          if (
            tempRecordsSelectedControls.length > 0 &&
            !tempRecordsSelectedControls.includes(record["æ“ä½œæ–¹æ³•"])
          )
            return false;
          if (
            tempRecordsApprovalFilter === "approved" &&
            record["æ‰¿èªçŠ¶æ…‹"] !== "OK"
          )
            return false;
          return true;
        }).length;

        const countEl = document.getElementById("recordsFilterRecordCount");
        const errorEl = document.getElementById("recordsFilterError");
        const applyBtn = document.getElementById("recordsApplyFilterBtn");

        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        const isValid =
          tempRecordsSelectedVersions.length > 0 &&
          tempRecordsSelectedControls.length > 0;

        if (!isValid) {
          countEl.textContent = `è¨˜éŒ²æ•°: -`;
          countEl.classList.add("error");
          errorEl.classList.add("show");
          applyBtn.disabled = true;
        } else {
          countEl.textContent = `è¨˜éŒ²æ•°: ${filteredCount}ä»¶`;
          countEl.classList.remove("error");
          errorEl.classList.remove("show");
          applyBtn.disabled = false;
        }
      }

      /**
       * ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
       */
      function applyRecordsFilter() {
        recordsCategory = document.getElementById(
          "recordsCategorySelect",
        ).value;
        recordsCourse = document.getElementById("recordsCourseSelect").value;
        renderRecordsTable();

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é–‰ã˜ã‚‹
        const header = document.getElementById("recordsFilterHeader");
        const content = document.getElementById("recordsFilterContent");
        header.classList.remove("active");
        content.classList.remove("open");
        isRecordsFilterOpen = false;
      }

      /**
       * ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é–‹é–‰
       */
      function toggleRecordsFilterAccordion() {
        const header = document.getElementById("recordsFilterHeader");
        const content = document.getElementById("recordsFilterContent");

        isRecordsFilterOpen = !isRecordsFilterOpen;

        if (isRecordsFilterOpen) {
          header.classList.add("active");
          content.classList.add("open");
        } else {
          header.classList.remove("active");
          content.classList.remove("open");
        }
      }

      // ========================================
      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
      // ========================================
      init();
    </script>
  </body>
</html>
